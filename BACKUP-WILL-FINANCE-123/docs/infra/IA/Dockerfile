<<<<<<< HEAD
# =============================================================================
# ðŸ¤– AI Environment Dockerfile - Will Finance 5.0
# =============================================================================
# Otimizado para seguranÃ§a, performance e manutenibilidade
# Baseado em anÃ¡lise automatizada e melhores prÃ¡ticas Docker

# Build arguments para configuraÃ§Ã£o flexÃ­vel
ARG PYTHON_VERSION=3.12
ARG DEBIAN_VERSION=bookworm
ARG USER_ID=1001
ARG GROUP_ID=1001

# Imagem base otimizada e segura
FROM python:${PYTHON_VERSION}-slim-${DEBIAN_VERSION}

# Labels informativos para metadados
LABEL maintainer="Will Finance Team" \
      version="5.0" \
      description="AI Environment for Financial Management System" \
      org.opencontainers.image.source="https://github.com/William-kelvem94/Gerenciador_Financeiro-5.0" \
      org.opencontainers.image.documentation="https://github.com/William-kelvem94/Gerenciador_Financeiro-5.0/blob/main/README.md"

# VariÃ¡veis de ambiente seguras e otimizadas
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1 \
    PIP_DISABLE_PIP_VERSION_CHECK=1 \
    PIP_ROOT_USER_ACTION=ignore \
    PYTHONPATH="/workspace" \
    AI_MODEL_PATH="/app/models/finance_predictor_v6.h5" \
    API_PORT=8001 \
    PATH="/home/appuser/.local/bin:${PATH}"

# InstalaÃ§Ã£o otimizada de dependÃªncias do sistema
RUN set -ex && \
    # Atualiza sistema e instala dependÃªncias essenciais
    apt-get update && \
    apt-get upgrade -y && \
    apt-get install -y --no-install-recommends \
        libglib2.0-0 libsm6 libxext6 libxrender1 curl && \
    # Limpeza completa do cache apt
    apt-get autoremove -y && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* && \
    # Atualiza pip e instala wheel
    pip install --no-cache-dir --upgrade pip wheel

# CriaÃ§Ã£o de usuÃ¡rio nÃ£o-root para seguranÃ§a
RUN groupadd -g ${GROUP_ID} appgroup && \
    useradd -u ${USER_ID} -g appgroup -m appuser && \
    # Cria diretÃ³rios necessÃ¡rios com permissÃµes adequadas
    mkdir -p /workspace/IA /app/models && \
    chown appuser:appgroup /workspace /app/models

# ConfiguraÃ§Ã£o do workspace
WORKDIR /workspace

# InstalaÃ§Ã£o de pacotes Python com versÃµes fixas (para reprodutibilidade)
RUN pip install --no-cache-dir --user \
        numpy==1.26.4 torch==2.1.2 torchaudio==2.1.2 torchvision==0.16.2

# InstalaÃ§Ã£o de pacotes Python sem versÃ£o especÃ­fica
RUN pip install --no-cache-dir --user \
        datasets transformers notebook paddleocr python-doctr

# Copia arquivos da aplicaÃ§Ã£o com ownership adequado
# NOTA: Use .dockerignore para excluir arquivos desnecessÃ¡rios
COPY --chown=appuser:appgroup ./IA/ /workspace/IA/
COPY --chown=appuser:appgroup ./requirements.txt* /workspace/

# Muda para usuÃ¡rio nÃ£o-root
USER appuser

# Instala dependÃªncias especÃ­ficas do projeto se existirem
RUN if [ -f requirements.txt ]; then pip install --no-cache-dir --user -r requirements.txt; fi

# Define diretÃ³rio de trabalho final
WORKDIR /workspace/IA

# Healthcheck para monitoramento do container
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD python -c "import sys; sys.exit(0)" || exit 1

# ExposiÃ§Ã£o de porta (se necessÃ¡rio)
# EXPOSE 8001

# Comando padrÃ£o otimizado
CMD ["python", "-c", "print('ðŸ¤– Will Finance AI Environment Ready!'); import time; time.sleep(60)"]
=======
FROM python:3.11-slim

# Set working directory
WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    tesseract-ocr \
    tesseract-ocr-por \
    libgl1-mesa-glx \
    libglib2.0-0 \
    libsm6 \
    libxext6 \
    libxrender-dev \
    libgomp1 \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements first for better caching
COPY requirements.txt .

# Install Python dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Copy application code
COPY . .

# Create directories for models and data
RUN mkdir -p /app/models /app/data /app/logs

# Set environment variables
ENV PYTHONPATH=/app
ENV AI_API_PORT=8001
ENV AI_MODEL_PATH=/app/models
ENV ENVIRONMENT=production

# Expose port
EXPOSE 8001

HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:8001/health || exit 1
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:8001/health || exit 1

# Command to run the application
CMD ["python", "api/main.py"]
>>>>>>> 19ae9cf82eb63c5cfccf5974311e9c254540a7d3
